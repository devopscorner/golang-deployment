# Golang Deployment

Kubernetes Deployment for Simple Golang API

![goreport](https://goreportcard.com/badge/github.com/devopscorner/golang-deployment/src) ![all contributors](https://img.shields.io/github/contributors/devopscorner/golang-deployment) ![tags](https://img.shields.io/github/v/tag/devopscorner/golang-deployment?sort=semver) [![docker pulls](https://img.shields.io/docker/pulls/devopscorner/bookstore.svg)](https://hub.docker.com/r/devopscorner/bookstore/) ![download all](https://img.shields.io/github/downloads/devopscorner/golang-deployment/total.svg) ![download latest](https://img.shields.io/github/downloads/devopscorner/golang-deployment/3.1/total) ![view](https://views.whatilearened.today/views/github/devopscorner/golang-deployment.svg) ![clone](https://img.shields.io/badge/dynamic/json?color=success&label=clone&query=count&url=https://github.com/devopscorner/golang-deployment/blob/master/clone.json?raw=True&logo=github) ![issues](https://img.shields.io/github/issues/devopscorner/golang-deployment) ![pull requests](https://img.shields.io/github/issues-pr/devopscorner/golang-deployment) ![forks](https://img.shields.io/github/forks/devopscorner/golang-deployment) ![stars](https://img.shields.io/github/stars/devopscorner/golang-deployment) [![license](https://img.shields.io/github/license/devopscorner/golang-deployment)](https://img.shields.io/github/license/devopscorner/golang-deployment)

## Available Tags

### Alpine

| Image name | Size |
|------------|------|
| `devopscorner/bookstore:latest` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/latest.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=latest) |
| `devopscorner/bookstore:alpine` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/alpine.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=alpine) |
| `devopscorner/bookstore:alpine-latest` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/alpine-latest.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=alpine-latest) |
| `devopscorner/bookstore:alpine-3.15` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/alpine-3.15.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=alpine-3.15) |
| `devopscorner/bookstore:go1.19-alpine3.15` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.19-alpine3.15.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.19-alpine3.15) |
| `devopscorner/bookstore:go1.19.3-alpine3.15` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.19.3-alpine3.15.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.19.3-alpine3.15) |
| `devopscorner/bookstore:alpine-3.16` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/alpine-3.16.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=alpine-3.16) |
| `devopscorner/bookstore:go1.19-alpine3.16` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.19-alpine3.16.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.19-alpine3.16) |
| `devopscorner/bookstore:go1.19.5-alpine3.16` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.19.5-alpine3.16.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.19.5-alpine3.16) |
| `devopscorner/bookstore:alpine-3.17` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/alpine-3.17.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=alpine-3.17) |
| `devopscorner/bookstore:go1.19-alpine3.17` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.19-alpine3.17.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.19-alpine3.17) |
| `devopscorner/bookstore:go1.19.5-alpine3.17` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.19.5-alpine3.17.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.19.5-alpine3.17) |


### Alpine (Depreciated)
| Image name | Size |
|------------|------|
| `devopscorner/bookstore:go1.18-alpine3.15` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.18-alpine3.15.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.18-alpine3.15) |
| `devopscorner/bookstore:go1.18-alpine3.16` | [![docker image size](https://img.shields.io/docker/image-size/devopscorner/bookstore/go1.18-alpine3.16.svg?label=Image%20size&logo=docker)](https://hub.docker.com/repository/docker/devopscorner/bookstore/tags?page=1&ordering=last_updated&name=go1.18-alpine3.16) |

---

### version 4.0

- All features in version 3.5
- Refactoring folder MVC with multiple driver ORM
  ```
      .
      ├── config
      │   ├── config.go
      │   └── config_test.go
      ├── controller
      │   ├── book_controller.go
      │   ├── book_controller_test.go
      │   ├── login_controller.go
      │   └── login_controller_test.go
      ├── driver
      │   ├── db.go
      │   ├── dynamo.go
      │   ├── mysql.go
      │   ├── psql.go
      │   └── sqlite.go
      ├── go-bookstore.db
      ├── go.mod
      ├── go.sum
      ├── main.go
      ├── main_test.go
      ├── middleware
      │   ├── auth_middleware.go
      │   └── auth_middleware_test.go
      ├── migrate_book.go.example
      ├── migrate_book_dynamo.go.example
      ├── model
      │   └── book.go
      ├── repository
      │   └── book_repository.go
      └── routes
          └── book_routes.go

      8 directories, 23 files
  ```
- Refactoring default environment variable
  ```
  GIN_MODE=release
  APP_URL=http://localhost
  APP_PORT=8080
  DB_CONNECTION=sqlite
  DB_REGION=ap-southeast-1
  DB_HOST=localhost
  DB_PORT=
  DB_DATABASE=go-bookstore.db
  DB_USERNAME=root
  DB_PASSWORD=
  JWT_AUTH_USERNAME=devopscorner
  JWT_AUTH_PASSWORD=DevOpsCorner@2023
  JWT_SECRET=s3cr3t
  ```
- Added multi driver database connection via ORM
  ```
  DB_CONNECTION=sqlite
  ---
  Available for:
  - sqlite
  - mysql
  - postgres
  - dynamo
  ```

- DynamoDB Connection
  ```
  DB_CONNECTION=dynamo
  ---
  DB_DATABASE --> Dynamo Table
  DB_REGION   --> Dynamo Region
  ```

---

### version 3.5

- All features in version 3.4
- Refactoring all folders for MVC Repository Pattern
  ```
    .
    ├── config
    │   ├── config.go
    │   └── config_test.go
    ├── controller
    │   ├── book_controller.go
    │   ├── book_controller_test.go
    │   ├── login_controller.go
    │   └── login_controller_test.go
    ├── driver
    │   └── sqlite.go
    ├── go-bookstore.db
    ├── go.mod
    ├── go.sum
    ├── main.go
    ├── main_test.go
    ├── middleware
    │   ├── auth_middleware.go
    │   └── auth_middleware_test.go
    ├── migrate_book.go
    ├── model
    │   └── book.go
    ├── repository
    │   └── book_repository.go
    └── routes
        └── book_routes.go

    7 directories, 18 files
  ```
- Added JWT Token for security authentification as Middleware
- Added Unit Test for Contoller, Repository & Main
- Added Default Environment Variables:
  ```
  PORT=8080
  DBNAME=go-bookstore.db
  GIN_MODE=release
  AUTH_USERNAME=devopscorner
  AUTH_PASSWORD=DevOpsCorner@2023
  JWT_SECRET=s3cr3t
  ```
- Update Postman Collection for Automation Testing
- Setup .env to default entrypoint
- Added environment variable for docker-compose.yml

---

### version 3.4

- All features in version 3.3
- Added Terraform script:
  - GitHub, AWS CodeBuild, AWS CodePipeline & Amazon SNS
  - AWS CodeCommit, AWS CodeBuild, AWS CodePipeline & Amazon SNS
- Added CloudFormation script:
  - GitHub, AWS CodeBuild, AWS CodePipeline & Amazon SNS
  - AWS CodeCommit, AWS CodeBuild, AWS CodePipeline & Amazon SNS

---

### version 3.3

- All features in version 3.2
- Deployment for CI/CD Pipeline:
  - **ArgoCD**, detail [here](docs/deployment-argocd.md) link
  - **AWS Developer Tools** (AWS CodeCommit, AWS CodeBuild & AWS CodePipeline), detail [here](docs/deployment-aws-developer-tools.md) link
  - **Azure DevOps Pipeline**, detail [here](docs/deployment-azure-devops.md) link
  - **Bitbucket Pipeline**, detail [here](docs/deployment-bitbucket.md) link
  - **CircleCI Pipeline**, detail [here](docs/deployment-circleci.md) link
  - **DroneCI Pipeline**, detail [here](docs/deployment-droneci.md) link
  - **GitHub Action**, detail [here](docs/deployment-github.md) link
  - **GitLab CI/CD**, detail [here](docs/deployment-gitlab.md) link
  - **Jenkins CI & Spinnaker CD**, detail [here](docs/deployment-jenkins-spinnaker.md) link
  - **Jenkins CI/CD**, detail [here](docs/deployment-jenkins.md) link
  - **OpenShift CI/CD**, detail [here](docs/deployment-openshift.md) link
  - **SemaphoreCI**, detail [here](docs/deployment-semaphoreci.md) link
  - **Spinnaker CD**, detail [here](docs/deployment-spinnaker.md) link
  - **Terraform AWS CodeBuild, AWS CodePipeline & Amazon SNS**, detail [here](docs/deployment-terraform.md) link
  - **TravisCI**, detail [here](docs/deployment-travisci.md) link

---

### version 3.3

- All features in version 3.2
- Deployment for CI/CD Pipeline:
  - **ArgoCD**, detail [here](docs/deployment-argocd.md) link
  - **AWS Developer Tools** (AWS CodeCommit, AWS CodeBuild & AWS CodePipeline), detail [here](docs/deployment-aws-developer-tools.md) link
  - **Azure DevOps Pipeline**, detail [here](docs/deployment-azure-devops.md) link
  - **Bitbucket Pipeline**, detail [here](docs/deployment-bitbucket.md) link
  - **CircleCI Pipeline**, detail [here](docs/deployment-circleci.md) link
  - **DroneCI Pipeline**, detail [here](docs/deployment-droneci.md) link
  - **GitHub Action**, detail [here](docs/deployment-github.md) link
  - **GitLab CI/CD**, detail [here](docs/deployment-gitlab.md) link
  - **Jenkins CI & Spinnaker CD**, detail [here](docs/deployment-jenkins-spinnaker.md) link
  - **Jenkins CI/CD**, detail [here](docs/deployment-jenkins.md) link
  - **OpenShift CI/CD**, detail [here](docs/deployment-openshift.md) link
  - **SemaphoreCI**, detail [here](docs/deployment-semaphoreci.md) link
  - **Spinnaker CD**, detail [here](docs/deployment-spinnaker.md) link
  - **Terraform AWS CodeBuild, AWS CodePipeline & Amazon SNS**, detail [here](docs/deployment-terraform.md) link
  - **TravisCI**, detail [here](docs/deployment-travisci.md) link

### version 3.2

- All features in version 3.1
- Added sample script CI/CD Pipeline with semantic version (semver) docker build images
  - AWS CodePipeline (`cicd-aws-codepipeline.yml`)
  - Azure DevOps (`cicd-azure-devops.yml`)
  - Bitbucket (`cicd-bitbucket.yml`)
  - GitHub Action (`cicd-github.yml`)
  - GitLab (`cicd-gitlab.yml`)
  - Jenkins CI/CD (`cicd-jenkins.jenkinsfile`)

---

### version 3.1

- All features in version 3.0
- Upgrade golang version 1.19.5
- Update `Dockerfile.alpine-3.15` for using golang version 1.19.3 for alpine-3.15 (`golang:1.19.3-alpine3.15`)
- Update `Dockerfile.alpine-3.16` for using golang version 1.19.5 for alpine-3.16 (`golang:1.19.5-alpine3.16`)
- Added `Dockerfile.alpine-3.17` for using golang version 1.19.5 for alpine-3.17 (`golang:1.19.5-alpine3.17`)
- Upgrade dependencies golang `go.mod` & `go.sum`
- Refactoring pattern source code (moving) to path "src"
- Refactoring CI/CD pipeline with spesific grouping folder
  - AWS CodePipeline (`.aws`)
  - Azure DevOps (`.azure-devops`)
  - Bitbucket (`.bitbucket`)
  - GitHub (`.github`)
  - GitLab (`.gitlab`)
  - Jenkins (`.jenkins`) CI/CD with Spinnaker CD
- Refactoring build, tag, push & pull script for DockerHub
- Refactoring build, tag, push & pull script for ECR
- Refactoring `makefile` script automation for build, tag, push & pull

---

### version 3.0

- All features in version 2.3
- Upgrade golang version 1.19
- Update Dockerfile for using golang version 1.19 (`golang:1.19.2-alpine3.15` & `golang:1.19.2-alpine3.16`)
- Added docker-compose configuration & running script docker-compose
- Upgrade dependencies golang `go.mod` & `go.sum`
- Refactoring source code (moving) dependencies to `devopscorner/golang-deployment`
- Update `gorm` model & sqlite connection driver

---

### version 2.3

- All features in version 2.2
- Refactoring path & references docs

---

### version 2.2

- Add multiple container registry (DockerHub & ECR) deployment
- Update Golang version 1.18 for Alpine 3.15 & Alpine 3.16 container
- Refactoring makefile for added multiple container registry
- Add documentation for build, tag & push container image to **DockerHub**, go to [this](docs/container-bookstore-dockerhub.md) link
- Add documentation for build, tag & push container to **Amazon ECR (Elastic Container Registry)**, go to [this](docs/container-bookstore-ecr.md) link
- Refactoring workflow documentation, go to [this](docs/workflow-cicd-bookstore-pipeline.md) link

---

### version 2.1

- Add Configuration Pipeline Synchronize for Mirroring Repository into AWS CodeCommit
  - [GitHub Repository](.github/workflows/synchronize.yml)
  - [GitLab Repository](.gitlab-ci.yml)
  - [BitBucket Repository](bitbucket-pipelines.yml)
  - [Azure DevOps Repository](azure-pipelines.yml)
- GitOps Flow
  - Azure DevOps Pipeline
    ![Azure DevOps Pipeline](docs/assets/gitops-flow-azure.png)
- GitOps DevSecOps Flow
  - Azure DevSecOps Pipeline
    ![Azure DevSecOps Pipeline](docs/assets/gitops-devsecops-azure.png)

---

### version 2.0

- IAM Role sample for CodeBuild & CodePipeline
- Buildspec CodePipeline for Build Container Image inside CodeBuild using Spesific CodeCommit
- Buildspec CodePipeline for Deploy EKS Cluster inside CodeBuild using Spesific CodeCommit
- Buildspec without CodePipeline for Build Container Image inside CodeBuild using 3rd party repository (GitHub, GitLab, BitBucket, Azure DevOps)
- Buildspec without CodePipeline for Deploy EKS Cluster inside CodeBuild using 3rd party repository (GitHub, GitLab, BitBucket, Azure DevOps)
- Setup `~/.ssh/known_hosts` for authorization host 3rd party repository
- Setup `~/.ssh/config` for authorization config ssh key 3rd party repository
- Dynamic Tags with COMMIT_HASH

---

### version 1.0

- Golang API Rest (bookstore)
- Postman Collection
- Container Builder GO
- Push Container to ECR
- Deploy Kubernetes with Helm Values
- Buildspec for AWS CodeBuild & AWS CodePipeline

---

### version 0.1

- First deployment GO Apps
- Script build image
- Script ecr-tag & ecr-push
- Helm deployment values
- Upgrade gomod, using GO `1.17`
- Dockerfile using `golang:1.17-alpine3.15`
